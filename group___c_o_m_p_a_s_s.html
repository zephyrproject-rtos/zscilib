<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Zephyr Scientific Library (zscilib): Compass</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Zephyr Scientific Library (zscilib)
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Compass<div class="ingroups"><a class="el" href="group___o_r_i_e_n_t_a_t_i_o_n.html">Orientation</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Compass functions based on magenetometer data.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:compass_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="compass_8h.html">compass.h</a></td></tr>
<tr class="memdesc:compass_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">API header file for compass calculations in zscilib. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga3493c733fe0ae3a05875b3ac71513016"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___c_o_m_p_a_s_s.html#ga3493c733fe0ae3a05875b3ac71513016">zsl_comp_dms_to_dd</a> (<a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> d, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> m, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> s, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *dd)</td></tr>
<tr class="memdesc:ga3493c733fe0ae3a05875b3ac71513016"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts dms (degrees, minutes, seconds) to decimal degrees.  <a href="group___c_o_m_p_a_s_s.html#ga3493c733fe0ae3a05875b3ac71513016">More...</a><br /></td></tr>
<tr class="separator:ga3493c733fe0ae3a05875b3ac71513016"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0796a39fcd930ac704797f43c96b1e01"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___c_o_m_p_a_s_s.html#ga0796a39fcd930ac704797f43c96b1e01">zsl_comp_magn_north</a> (struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *m, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *d)</td></tr>
<tr class="memdesc:ga0796a39fcd930ac704797f43c96b1e01"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the magnetic north of the earth (not the geographical north) based on magnetometer data.  <a href="group___c_o_m_p_a_s_s.html#ga0796a39fcd930ac704797f43c96b1e01">More...</a><br /></td></tr>
<tr class="separator:ga0796a39fcd930ac704797f43c96b1e01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga25c84bf038c3fea1923e09f4c0f7ff1f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___c_o_m_p_a_s_s.html#ga25c84bf038c3fea1923e09f4c0f7ff1f">zsl_comp_geo_north</a> (struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *m, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> dec, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *b)</td></tr>
<tr class="memdesc:ga25c84bf038c3fea1923e09f4c0f7ff1f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates geographic north (AKA true bearing) based on the supplied magnetometer data, and the magentic declination.  <a href="group___c_o_m_p_a_s_s.html#ga25c84bf038c3fea1923e09f4c0f7ff1f">More...</a><br /></td></tr>
<tr class="separator:ga25c84bf038c3fea1923e09f4c0f7ff1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Compass functions based on magenetometer data. </p>
<p>This modules provides functions to convert magnetometer readings &ndash; ideally from a data source that has been calibrated to remove hard-iron and soft-iron errors &ndash; into magnetic bearing and/or true bearing.</p>
<p>Magnetic bearing is determined in relation to magnetic north, whose position will vary from day to day depending on the latitude, longitude and date.</p>
<p>True (or geographic) bearing is determined in relation to true north &ndash; sometimes referred to as geographic north &ndash; which is the fixed, physical north pole.</p>
<p>The relationship between the true north and the shifting magnetic north is called the 'absolute bearing', and is usually calculated as a dms (decimal, minute, second) 'declination', given a specific latitude, longitude and date. The calculated declination can then be applied to the magnetic bearing measured by the magnetometer, and adjusted to account for the difference (positive or negative) between the two.</p>
<p>Several models exist to represent the current position of magnetic north relative to true north, each with an associated range of time since the models need to be updated over timee (i.e. WMM 2019-2024, IGRF 1590-2024, EMM 2000-2019, etc.). These models are generally too complex to implement in small embedded systems, so the 'declination' should be calculated using an appropriate exterrnal tool, and used in the embedded systeem as an updateable input.</p>
<p>Since declination is usually represented in dms (rather than decimal degrees), a helper function is provided to convert from dms (ex.: 2Â° 13' 0" East) to decimal degrees (2.216667 in this case). </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga3493c733fe0ae3a05875b3ac71513016"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3493c733fe0ae3a05875b3ac71513016">&#9670;&nbsp;</a></span>zsl_comp_dms_to_dd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int zsl_comp_dms_to_dd </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a>&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a>&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a>&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *&#160;</td>
          <td class="paramname"><em>dd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Converts dms (degrees, minutes, seconds) to decimal degrees. </p>
<p>Magnetic declination is most often represented in dms, so you may need to convert dms to decimal degrees for use with the declination property in <a class="el" href="group___c_o_m_p_a_s_s.html#ga25c84bf038c3fea1923e09f4c0f7ff1f">zsl_comp_geo_north</a>.</p>
<p>Note that the input 'd' value should be positive when east or north are used, and negative with west or south. 'm' and 's' should always be positive.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">d</td><td>Input dms degrees for latitude (negative for south and west). </td></tr>
    <tr><td class="paramname">m</td><td>Input dms minutes (always positive). </td></tr>
    <tr><td class="paramname">s</td><td>Input dms seconds (always positive). </td></tr>
    <tr><td class="paramname">dd</td><td>Pointer to the output decimal degrees value.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if everything executed normally, or a negative error code if the dimension of the magnetometer vector is not three. </dd></dl>

</div>
</div>
<a id="ga25c84bf038c3fea1923e09f4c0f7ff1f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga25c84bf038c3fea1923e09f4c0f7ff1f">&#9670;&nbsp;</a></span>zsl_comp_geo_north()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int zsl_comp_geo_north </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a>&#160;</td>
          <td class="paramname"><em>dec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates geographic north (AKA true bearing) based on the supplied magnetometer data, and the magentic declination. </p>
<p>This function first calculates the magnetic bearing, determined based on the supplied magnetometer values 'm', and adjusts it for the provided magnetic declination 'dec' (in degrees), which represents the difference between geographic north of the earth and magentic north at a given latitude and date. The final result represents the true bearing or rather the deviation from true north in degrees.</p>
<p>The exact magnetic declination changes over time and location, and can't be easily modeled on small embedded systems, so it must be determined from an external source.</p>
<p>To find the value of the magnetic declination angle based on the date, latitude, longitude and altitude, one can use the following online calculator: <a href="https://www.ngdc.noaa.gov/geomag/calculators/magcalc.shtml?#igrfwmm">https://www.ngdc.noaa.gov/geomag/calculators/magcalc.shtml?#igrfwmm</a></p>
<p>This function assumes that the z axis of the magnetometer is orientated upwards, and that the input magnetometer data has already been corrected for hard and soft iron errors.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td>Input magnetometer tridimensional vector, in micro Tesla. </td></tr>
    <tr><td class="paramname">dec</td><td>Input magnetic declination, in degrees. </td></tr>
    <tr><td class="paramname">b</td><td>Output angle deviation between true or geographic north and the x axis, in degrees (AKA true bearing).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if everything executed normally, or a negative error code if the dimension of the magnetometer vector is not three. </dd></dl>

</div>
</div>
<a id="ga0796a39fcd930ac704797f43c96b1e01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0796a39fcd930ac704797f43c96b1e01">&#9670;&nbsp;</a></span>zsl_comp_magn_north()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int zsl_comp_magn_north </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *&#160;</td>
          <td class="paramname"><em>d</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the magnetic north of the earth (not the geographical north) based on magnetometer data. </p>
<p>This function assumes that the z axis of the magnetometer is orientated upwards, and that the input magnetometer data has already been corrected for hard and soft iron errors.</p>
<p>The output of this function is an angle, which can be understood as the angle between the magnetic north and the x axis of the magnetometer.</p>
<p>Source: <a href="https://cdn-shop.adafruit.com/datasheets/AN203_Compass_Heading_Using_Magnetometers.pdf">https://cdn-shop.adafruit.com/datasheets/AN203_Compass_Heading_Using_Magnetometers.pdf</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td>Input corrected magnetometer tridimensional vector, in micro Tesla. </td></tr>
    <tr><td class="paramname">d</td><td>Output angle between the magnetic north and the x axis, in degrees.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if everything executed normally, or a negative error code if the dimension of the magnetometer vector is not three. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
