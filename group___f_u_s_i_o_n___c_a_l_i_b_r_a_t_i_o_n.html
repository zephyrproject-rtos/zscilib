<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Zephyr Scientific Library (zscilib): Calibration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Zephyr Scientific Library (zscilib)
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Calibration<div class="ingroups"><a class="el" href="group___o_r_i_e_n_t_a_t_i_o_n.html">Orientation</a> &raquo; <a class="el" href="group___f_u_s_i_o_n.html">Sensor Fusion</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Sensor fusion calibration.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:calibration_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="calibration_8h.html">calibration.h</a></td></tr>
<tr class="memdesc:calibration_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calibration helper functions. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga4932407824727452e6247e7ceb3d2a54"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___f_u_s_i_o_n___c_a_l_i_b_r_a_t_i_o_n.html#ga4932407824727452e6247e7ceb3d2a54">zsl_fus_cal_rot_mtx</a> (struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *v, struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *m, struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *v_rot)</td></tr>
<tr class="memdesc:ga4932407824727452e6247e7ceb3d2a54"><td class="mdescLeft">&#160;</td><td class="mdescRight">Rotates accel/mag/gyro data using a given rotation matrix.  <a href="group___f_u_s_i_o_n___c_a_l_i_b_r_a_t_i_o_n.html#ga4932407824727452e6247e7ceb3d2a54">More...</a><br /></td></tr>
<tr class="separator:ga4932407824727452e6247e7ceb3d2a54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5d86694871fec1cbe24b28e58940ef79"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___f_u_s_i_o_n___c_a_l_i_b_r_a_t_i_o_n.html#ga5d86694871fec1cbe24b28e58940ef79">zsl_fus_cal_rot_axis_angle</a> (struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *v, struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *a, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *b, struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *v_rot)</td></tr>
<tr class="memdesc:ga5d86694871fec1cbe24b28e58940ef79"><td class="mdescLeft">&#160;</td><td class="mdescRight">Rotates accel/mag/gyro data using a given axis and angle.  <a href="group___f_u_s_i_o_n___c_a_l_i_b_r_a_t_i_o_n.html#ga5d86694871fec1cbe24b28e58940ef79">More...</a><br /></td></tr>
<tr class="separator:ga5d86694871fec1cbe24b28e58940ef79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga24c4e6b206050c372cede1cccf0231f5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___f_u_s_i_o_n___c_a_l_i_b_r_a_t_i_o_n.html#ga24c4e6b206050c372cede1cccf0231f5">zsl_fus_cal_magn</a> (struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *m, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *l, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *mu, struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *K, struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *b)</td></tr>
<tr class="memdesc:ga24c4e6b206050c372cede1cccf0231f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function calculates the soft iron ('K') and the hard iron ('b') errors in the magnetometer data, using the Levenberg–Marquardt algorithm and spherical and ellipsoid fitting.  <a href="group___f_u_s_i_o_n___c_a_l_i_b_r_a_t_i_o_n.html#ga24c4e6b206050c372cede1cccf0231f5">More...</a><br /></td></tr>
<tr class="separator:ga24c4e6b206050c372cede1cccf0231f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab677f78f2b9734bd36b5b4155c1c4fd7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___f_u_s_i_o_n___c_a_l_i_b_r_a_t_i_o_n.html#gab677f78f2b9734bd36b5b4155c1c4fd7">zsl_fus_cal_magn_fast</a> (struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *m, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *me, struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *K, struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *b)</td></tr>
<tr class="memdesc:gab677f78f2b9734bd36b5b4155c1c4fd7"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function calculates the soft iron ('K') and the hard iron ('b') errors in the magnetometer data, using the least squares method for ellipsoid fitting.  <a href="group___f_u_s_i_o_n___c_a_l_i_b_r_a_t_i_o_n.html#gab677f78f2b9734bd36b5b4155c1c4fd7">More...</a><br /></td></tr>
<tr class="separator:gab677f78f2b9734bd36b5b4155c1c4fd7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga31513d1dcd54c771fa3c9d8ef2bf6d99"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___f_u_s_i_o_n___c_a_l_i_b_r_a_t_i_o_n.html#ga31513d1dcd54c771fa3c9d8ef2bf6d99">zsl_fus_cal_corr_scalar</a> (<a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *d, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *k, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *b, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *d_out)</td></tr>
<tr class="memdesc:ga31513d1dcd54c771fa3c9d8ef2bf6d99"><td class="mdescLeft">&#160;</td><td class="mdescRight">Corrects the supplied scalar number by adding another number ('b') and multiplying the sum by a scalar 'k'.  <a href="group___f_u_s_i_o_n___c_a_l_i_b_r_a_t_i_o_n.html#ga31513d1dcd54c771fa3c9d8ef2bf6d99">More...</a><br /></td></tr>
<tr class="separator:ga31513d1dcd54c771fa3c9d8ef2bf6d99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0a0d39e46625883e03efeb2cff2b019d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___f_u_s_i_o_n___c_a_l_i_b_r_a_t_i_o_n.html#ga0a0d39e46625883e03efeb2cff2b019d">zsl_fus_cal_corr_vec</a> (struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *v, struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *K, struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *b, struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *v_out)</td></tr>
<tr class="memdesc:ga0a0d39e46625883e03efeb2cff2b019d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Corrects the supplied vector data by adding a vector the same size ('b') and then multiplying by a matrix 'K'.  <a href="group___f_u_s_i_o_n___c_a_l_i_b_r_a_t_i_o_n.html#ga0a0d39e46625883e03efeb2cff2b019d">More...</a><br /></td></tr>
<tr class="separator:ga0a0d39e46625883e03efeb2cff2b019d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga11b857506fc9ffbbfac017173354b835"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___f_u_s_i_o_n___c_a_l_i_b_r_a_t_i_o_n.html#ga11b857506fc9ffbbfac017173354b835">zsl_fus_cal_madg</a> (struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *g, struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *a, struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *m, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> sampleFreq, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *incl, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *beta)</td></tr>
<tr class="memdesc:ga11b857506fc9ffbbfac017173354b835"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the optimal value of the variable beta in the Madgwick filter, given a set of magnetometer, accelerometer and gyroscope readings.  <a href="group___f_u_s_i_o_n___c_a_l_i_b_r_a_t_i_o_n.html#ga11b857506fc9ffbbfac017173354b835">More...</a><br /></td></tr>
<tr class="separator:ga11b857506fc9ffbbfac017173354b835"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga475c505ddc2d8ed7c486169e4c027e56"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___f_u_s_i_o_n___c_a_l_i_b_r_a_t_i_o_n.html#ga475c505ddc2d8ed7c486169e4c027e56">zsl_fus_cal_mahn</a> (struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *g, struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *a, struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *m, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> sampleFreq, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *incl, <a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *kp)</td></tr>
<tr class="memdesc:ga475c505ddc2d8ed7c486169e4c027e56"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the optimal value of the variable kp in the Mahony filter, given a set of magnetometer, accelerometer and gyroscope readings. This function assumes that the optimal value of ki is 0.02.  <a href="group___f_u_s_i_o_n___c_a_l_i_b_r_a_t_i_o_n.html#ga475c505ddc2d8ed7c486169e4c027e56">More...</a><br /></td></tr>
<tr class="separator:ga475c505ddc2d8ed7c486169e4c027e56"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Sensor fusion calibration. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga31513d1dcd54c771fa3c9d8ef2bf6d99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga31513d1dcd54c771fa3c9d8ef2bf6d99">&#9670;&nbsp;</a></span>zsl_fus_cal_corr_scalar()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int zsl_fus_cal_corr_scalar </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *&#160;</td>
          <td class="paramname"><em>d_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Corrects the supplied scalar number by adding another number ('b') and multiplying the sum by a scalar 'k'. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">d</td><td>Pointer to the input scalar to correct. </td></tr>
    <tr><td class="paramname">k</td><td>Pointer to the first input error scalar. </td></tr>
    <tr><td class="paramname">b</td><td>Pointer to the second input error scalar. </td></tr>
    <tr><td class="paramname">d_out</td><td>Pointer to the output corrected scalar.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if everything executed normally, or a proper negative error code. </dd></dl>

</div>
</div>
<a id="ga0a0d39e46625883e03efeb2cff2b019d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0a0d39e46625883e03efeb2cff2b019d">&#9670;&nbsp;</a></span>zsl_fus_cal_corr_vec()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int zsl_fus_cal_corr_vec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *&#160;</td>
          <td class="paramname"><em>K</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *&#160;</td>
          <td class="paramname"><em>v_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Corrects the supplied vector data by adding a vector the same size ('b') and then multiplying by a matrix 'K'. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the input data vector to correct. </td></tr>
    <tr><td class="paramname">K</td><td>Pointer to the input error matrix. </td></tr>
    <tr><td class="paramname">b</td><td>Pointer to the input error vector. </td></tr>
    <tr><td class="paramname">v_out</td><td>Pointer to the output corrected data vector.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if everything executed normally, or a negative error code if the dimension of the vectors and matrices don't match. </dd></dl>

</div>
</div>
<a id="ga11b857506fc9ffbbfac017173354b835"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga11b857506fc9ffbbfac017173354b835">&#9670;&nbsp;</a></span>zsl_fus_cal_madg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int zsl_fus_cal_madg </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *&#160;</td>
          <td class="paramname"><em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a>&#160;</td>
          <td class="paramname"><em>sampleFreq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *&#160;</td>
          <td class="paramname"><em>incl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *&#160;</td>
          <td class="paramname"><em>beta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the optimal value of the variable beta in the Madgwick filter, given a set of magnetometer, accelerometer and gyroscope readings. </p>
<p>Source: <a href="http://iieng.org/images/proceedings_pdf/7697E0314552.pdf">http://iieng.org/images/proceedings_pdf/7697E0314552.pdf</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>Input accelerometer Nx3 matrix. NULL if none. </td></tr>
    <tr><td class="paramname">m</td><td>Input magnetometer Nx3 matrix. NULL if none. </td></tr>
    <tr><td class="paramname">g</td><td>Input gyroscope Nx3 matrix. NULL if none. </td></tr>
    <tr><td class="paramname">sampleFreq</td><td>Sampling frequency in Hz. Must be positive. </td></tr>
    <tr><td class="paramname">incl</td><td>Input magnetic declination, in radians. NULL for none. </td></tr>
    <tr><td class="paramname">beta</td><td>Output calculated optimal value of beta.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if everything executed normally, or a negative error code if the dimension of the matrices is not Nx3, or if the frequency is neg. </dd></dl>

</div>
</div>
<a id="ga24c4e6b206050c372cede1cccf0231f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga24c4e6b206050c372cede1cccf0231f5">&#9670;&nbsp;</a></span>zsl_fus_cal_magn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int zsl_fus_cal_magn </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *&#160;</td>
          <td class="paramname"><em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *&#160;</td>
          <td class="paramname"><em>mu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *&#160;</td>
          <td class="paramname"><em>K</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function calculates the soft iron ('K') and the hard iron ('b') errors in the magnetometer data, using the Levenberg–Marquardt algorithm and spherical and ellipsoid fitting. </p>
<p>Source: <a href="https://journals.sagepub.com/doi/full/10.1177/0020294019890627">https://journals.sagepub.com/doi/full/10.1177/0020294019890627</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td>Pointer to the input Nx3 matrix, whose rows consist of distinct magnetometer data samples. </td></tr>
    <tr><td class="paramname">l</td><td>Damping parameter used to control the iterative process. Typically set to 1. </td></tr>
    <tr><td class="paramname">mu</td><td>Control parameter used to increase or decrease lambda each step. Must be larger than one. Typically set to 10. </td></tr>
    <tr><td class="paramname">K</td><td>Pointer to the output soft iron error 3x3 symmetric matrix. </td></tr>
    <tr><td class="paramname">b</td><td>Pointer to the output hard iron error tridimensional vector.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if everything executed normally, or a negative error code if the dimension of the vector and matrices are invalid, or if mu &lt; 1. </dd></dl>

</div>
</div>
<a id="gab677f78f2b9734bd36b5b4155c1c4fd7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab677f78f2b9734bd36b5b4155c1c4fd7">&#9670;&nbsp;</a></span>zsl_fus_cal_magn_fast()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int zsl_fus_cal_magn_fast </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *&#160;</td>
          <td class="paramname"><em>me</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *&#160;</td>
          <td class="paramname"><em>K</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function calculates the soft iron ('K') and the hard iron ('b') errors in the magnetometer data, using the least squares method for ellipsoid fitting. </p>
<p>This algorithm is faster than the previous one, which serves the same function. In exchange, this function uses more memory.</p>
<p>In this function, the module of the Earth's magnetic field at one's location and date must be known. One can use the following web page to obtain this parameter: <a href="https://www.ngdc.noaa.gov/geomag/calculators/magcalc.shtml?#igrfwmm">https://www.ngdc.noaa.gov/geomag/calculators/magcalc.shtml?#igrfwmm</a></p>
<p>It will be displayed as the "Total Field", and should be converted from nT to uT, so for a given value of 44387.0 nT, we could use 44.387 for 'me'.</p>
<p>If you are unable to input or calculate an accurate value of 'me' yourself, provide NULL to this argument and an approximation ot 50 uT will be used.</p>
<p>Source of the algorithm: <a href="https://www.researchgate.net/publication/331874483_Calibration_of_triaxial_magnetometer_with_ellipsoid_fitting_method">https://www.researchgate.net/publication/331874483_Calibration_of_triaxial_magnetometer_with_ellipsoid_fitting_method</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">m</td><td>Pointer to the input Nx3 matrix, whose rows consist of distinct magnetometer data samples. </td></tr>
    <tr><td class="paramname">me</td><td>Module of the magnetic field of the Earth at the current location (latitude, longitude and altitude) and date, in micro Tesla. If no value is known, provide NULL and an approximation will be used. </td></tr>
    <tr><td class="paramname">K</td><td>Pointer to the output soft iron error 3x3 symmetric matrix. </td></tr>
    <tr><td class="paramname">b</td><td>Pointer to the output hard iron error tridimensional vector.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if everything executed normally, or a negative error code if the dimension of the vector and matrices are invalid, or if me &lt; 0. </dd></dl>

</div>
</div>
<a id="ga475c505ddc2d8ed7c486169e4c027e56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga475c505ddc2d8ed7c486169e4c027e56">&#9670;&nbsp;</a></span>zsl_fus_cal_mahn()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int zsl_fus_cal_mahn </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *&#160;</td>
          <td class="paramname"><em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a>&#160;</td>
          <td class="paramname"><em>sampleFreq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *&#160;</td>
          <td class="paramname"><em>incl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *&#160;</td>
          <td class="paramname"><em>kp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the optimal value of the variable kp in the Mahony filter, given a set of magnetometer, accelerometer and gyroscope readings. This function assumes that the optimal value of ki is 0.02. </p>
<p>Source: <a href="http://iieng.org/images/proceedings_pdf/7697E0314552.pdf">http://iieng.org/images/proceedings_pdf/7697E0314552.pdf</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>Input accelerometer Nx3 matrix. NULL if none. </td></tr>
    <tr><td class="paramname">m</td><td>Input magnetometer Nx3 matrix. NULL if none. </td></tr>
    <tr><td class="paramname">g</td><td>Input gyroscope Nx3 matrix. NULL if none. </td></tr>
    <tr><td class="paramname">sampleFreq</td><td>Sampling frequency in Hz. Must be positive. </td></tr>
    <tr><td class="paramname">incl</td><td>Input magnetic declination, in radians. NULL for none. </td></tr>
    <tr><td class="paramname">kp</td><td>Output calculated optimal value of beta.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if everything executed normally, or a negative error code if the dimension of the matrices is not Nx3, or if the frequency is neg. </dd></dl>

</div>
</div>
<a id="ga5d86694871fec1cbe24b28e58940ef79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5d86694871fec1cbe24b28e58940ef79">&#9670;&nbsp;</a></span>zsl_fus_cal_rot_axis_angle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int zsl_fus_cal_rot_axis_angle </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="zsl_8h.html#a057fbb03c8054ee788abfe8231ad8c81">zsl_real_t</a> *&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *&#160;</td>
          <td class="paramname"><em>v_rot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Rotates accel/mag/gyro data using a given axis and angle. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the tridimensional vector to rotate. </td></tr>
    <tr><td class="paramname">a</td><td>Pointer to the rotation axis. </td></tr>
    <tr><td class="paramname">b</td><td>Pointer to the angle of rotation, in radians. </td></tr>
    <tr><td class="paramname">v_rot</td><td>Pointer to the output rotated vector.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if everything executed normally, or a negative error code if the dimension of the vectors or the axis 'a' is not three. </dd></dl>

</div>
</div>
<a id="ga4932407824727452e6247e7ceb3d2a54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4932407824727452e6247e7ceb3d2a54">&#9670;&nbsp;</a></span>zsl_fus_cal_rot_mtx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int zsl_fus_cal_rot_mtx </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structzsl__mtx.html">zsl_mtx</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structzsl__vec.html">zsl_vec</a> *&#160;</td>
          <td class="paramname"><em>v_rot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Rotates accel/mag/gyro data using a given rotation matrix. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Pointer to the tridimensional vector to rotate. </td></tr>
    <tr><td class="paramname">m</td><td>Pointer to the 3x3 rotation matrix. </td></tr>
    <tr><td class="paramname">v_rot</td><td>Pointer to the output rotated vector.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if everything executed normally, or a negative error code if the dimension of the vectors or the square maatrix 'm' is not three. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
